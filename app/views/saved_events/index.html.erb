<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold mb-0">My Saved Events</h2>
      <p class="text-muted">Opportunities you have bookmarked for later.</p>
    </div>
    <%= link_to "Back to Dashboard", dashboard_path, class: "btn btn-outline-secondary btn-sm" %>
  </div>

  <% if @events.any? %>
    <div class="row g-4">
      <% @events.each do |event| %>
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm border-0">
            <div class="card-body d-flex flex-column">
              <!-- Header Badges -->
              <div class="d-flex justify-content-between mb-2">
                <span class="badge bg-light text-primary border"><%= event.event_type %></span>
                <span class="badge bg-light text-secondary border"><%= event.category %></span>
              </div>
              
              <!-- Content -->
              <h5 class="card-title fw-bold mt-2"><%= event.title %></h5>
              <h6 class="card-subtitle mb-3 text-muted"><%= event.provider %></h6>
              
              <div class="mb-3 small border-top pt-3 mt-2">
                <div class="d-flex align-items-center mb-1 text-secondary">
                  <i class="bi bi-calendar-event me-2"></i> 
                  <%= event.date.strftime("%B %d, %Y") %>
                </div>
                <div class="d-flex align-items-center mb-1 text-secondary">
                  <i class="bi bi-geo-alt me-2"></i> 
                  <%= event.location %>
                </div>
                <div class="d-flex align-items-center text-secondary">
                  <i class="bi bi-patch-check me-2"></i> 
                  <%= event.credits %> Credits
                </div>
              </div>
              
              <!-- Actions -->
              <div class="mt-auto d-grid gap-2">
                <%# Find the specific saved_event record ID %>
                <% saved_record = current_user.saved_events.find_by(ceu_event_id: event.id) %>

                <!-- Mark as Complete Button -->
                <!-- Passes the event ID to import data, and saved_record ID to delete it later -->
                <%= link_to new_ceu_path(import_event_id: event.id, saved_event_id: saved_record.id), class: "btn btn-success w-100 d-flex align-items-center justify-content-center gap-2" do %>
                  <i class="bi bi-check-circle-fill"></i> Complete & Log
                <% end %>
                
                <%= link_to "View Details", event.url.present? ? event.url : "#", target: "_blank", class: "btn btn-outline-primary btn-sm" %>
                
                <%= button_to saved_event_path(saved_record), method: :delete, class: "btn btn-sm btn-link text-danger text-decoration-none w-100 mt-1" do %>
                  Remove from Saved
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

  <% else %>
    <!-- Empty State -->
    <div class="text-center py-5 bg-white rounded shadow-sm border">
      <i class="bi bi-bookmark-x display-1 text-muted opacity-25"></i>
      <h3 class="mt-3 text-muted">No saved events yet</h3>
      <p class="text-muted mb-4">Browse our database to find classes and conferences.</p>
      <%= link_to "Find Opportunities", events_path, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>