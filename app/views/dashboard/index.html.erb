<div class="container py-5">
  <div class="row">
    
    <!-- Sidebar / Profile Summary -->
    <div class="col-lg-3 mb-4">
      <div class="card shadow-sm text-center">
        <div class="card-body d-flex flex-column align-items-center justify-content-center">
          <div class="d-inline-flex align-items-center justify-content-center bg-light text-primary rounded-circle mb-3" style="width: 80px; height: 80px; font-size: 2rem; font-weight: bold;">
            <% if @profile.first_name.present? %>
              <%= @profile.first_name.first %><%= @profile.last_name.first %>
            <% else %>
              <i class="bi bi-person"></i>
            <% end %>
          </div>
          
          <h5 class="card-title mb-0"><%= @profile.full_name.presence || "User" %></h5>
          <p class="card-text text-muted small mb-4">
            <% if @profile.city.present? %>
              <%= @profile.city %>, <%= @profile.state %>
            <% else %>
              Location not set
            <% end %>
          </p>
          
          <div class="d-grid gap-2 w-100">
            <%= link_to "Edit Profile", 
                        edit_profile_path, 
                        class: "btn btn-outline-primary" %>
            
            <!-- NEW: Search Link in Sidebar -->
            <%= link_to "Find CEUs", 
                        events_path, 
                        class: "btn btn-outline-secondary" %>

            <%= button_to "Log Out", 
                          logout_path, 
                          method: :delete, 
                          class: "btn btn-outline-danger w-100" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-lg-9">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold mb-0">Dashboard</h2>
      </div>
      
      <!-- Stats Row -->
      <div class="row g-3 mb-5">
        <div class="col-md-4">
          <div class="card bg-primary text-white h-100 shadow-sm">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 opacity-75">Active Licenses</h6>
              <h2 class="card-title mb-0 display-6 fw-bold"><%= @licenses.count %></h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-success text-white h-100 shadow-sm">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 opacity-75">Total CEUs</h6>
              <h2 class="card-title mb-0 display-6 fw-bold"><%= @ceus.sum(:duration) %></h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-warning text-dark h-100 shadow-sm">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-dark opacity-75">Expiring (90 Days)</h6>
              <h2 class="card-title mb-0 display-6 fw-bold"><%= @expiring_licenses_count %></h2>
            </div>
          </div>
        </div>
      </div>

      <!-- Licenses Section -->
      <div class="card shadow-sm mb-5">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Licenses</h5>
          <%= link_to "+ Add License", 
                      new_professional_license_path, 
                      class: "btn btn-sm btn-primary rounded-pill px-3" %>
        </div>
        <div class="card-body p-0">
          <% if @licenses.any? %>
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th class="ps-4">Authority / Board</th>
                    <th>License #</th>
                    <th>Status</th>
                    <th class="text-end pe-4">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @licenses.each do |license| %>
                    <tr>
                      <td class="ps-4 fw-medium text-primary"><%= license.issuing_authority.name %></td>
                      <td class="text-muted"><%= license.license_number %></td>
                      <td>
                        <% status_class = license.status_label == 'Active' ? 'bg-success-subtle text-success' : 'bg-warning-subtle text-warning-emphasis' %>
                        <span class="badge rounded-pill <%= status_class %>">
                          <%= license.status_label %>
                        </span>
                      </td>
                      <td class="text-end pe-4">
                        <div class="d-flex justify-content-end gap-1">
                          <%= link_to "Edit", 
                                      edit_professional_license_path(license), 
                                      class: "btn btn-sm btn-outline-secondary" %>
                          <%= button_to "Remove", 
                                        professional_license_path(license), 
                                        method: :delete, 
                                        class: "btn btn-sm btn-outline-danger", 
                                        data: { turbo_confirm: "Are you sure?" } %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="p-5 text-center text-muted">
              <p class="mb-0">No licenses added yet.</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- CEU History Section -->
      <div class="card shadow-sm mb-5">
        <div class="card-header bg-white py-3 d-flex flex-wrap justify-content-between align-items-center gap-2">
          <h5 class="mb-0">CEU History</h5>
          
          <div class="d-flex gap-2">
            <!-- EXPORT BUTTONS -->
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-download me-1"></i> Export
              </button>
              <ul class="dropdown-menu">
                <li>
                  <%= link_to export_report_path(format: :csv), class: "dropdown-item" do %>
                    <i class="bi bi-filetype-csv me-2"></i> Download CSV
                  <% end %>
                </li>
                <li>
                  <%= link_to export_report_path(format: :pdf), class: "dropdown-item", target: "_blank" do %>
                    <i class="bi bi-file-earmark-pdf me-2"></i> Download PDF
                  <% end %>
                </li>
              </ul>
            </div>

            <%= link_to "+ Log Class", 
                        new_ceu_path, 
                        class: "btn btn-sm btn-success rounded-pill px-3" %>
          </div>
        </div>
        <div class="card-body p-0">
          <% if @ceus.any? %>
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th class="ps-4">Date</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Proof</th>
                    <th class="text-end pe-4">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @ceus.each do |ceu| %>
                    <tr>
                      <td class="ps-4 text-muted"><%= ceu.date.strftime("%b %d, %Y") %></td>
                      <td class="fw-medium"><%= ceu.title %></td>
                      <td><%= ceu.duration %></td>
                      <td>
                        <% if ceu.certificate.attached? %>
                          <%= link_to "View PDF", 
                                      rails_blob_path(ceu.certificate, disposition: "preview"), 
                                      target: "_blank", 
                                      class: "btn btn-sm btn-link text-decoration-none p-0" %>
                        <% else %>
                          <span class="text-muted small">-</span>
                        <% end %>
                      </td>
                      <td class="text-end pe-4">
                        <div class="d-flex justify-content-end gap-1">
                          <%= link_to "Edit", 
                                      edit_ceu_path(ceu), 
                                      class: "btn btn-sm btn-outline-secondary" %>
                          <%= button_to "Remove", 
                                        ceu_path(ceu), 
                                        method: :delete, 
                                        class: "btn btn-sm btn-outline-danger", 
                                        data: { turbo_confirm: "Are you sure?" } %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="p-5 text-center text-muted">
              <p class="mb-0">No CEUs logged yet.</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- NEW SECTION: Find CEU Opportunities -->
      <div class="card bg-light border-0 shadow-sm">
        <div class="card-body p-4 d-flex align-items-center justify-content-between">
          <div>
            <h5 class="fw-bold text-primary mb-1">Need more credits?</h5>
            <p class="mb-0 text-muted">Browse our database of upcoming classes, webinars, and conferences.</p>
          </div>
          <%= link_to "Find Opportunities", events_path, class: "btn btn-primary" %>
        </div>
      </div>

    </div>
  </div>
</div>